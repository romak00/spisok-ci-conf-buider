
# Автоматизация сборщика вёрстки для конференции СПИСОК.

Этот репозиторий содержит программу, с настроенным CI pipeline, для автоматизации сборщика конференции. Может использоваться как полностью онлайн версия сборщика, без необходимости устанавливать какой либо софт, помимо клона репозитории.

Репозитория с примером на материалах конференции 2023 года:


## Использованные проекты

[Сборщик вёрски конференции](https://github.com/spbu-se/spisok-2023-proceedings) - изначальная программа версии 23 года.

[Проверка соответствия шаблону](https://github.com/veronikasblv/pdf-template-check) - делалась специально для этой конференции и использована тут.


## Краткие сведения о репозитории
Все это работает при помощи утилизации платформы GitHub Actions. 
- В директории **/.github/** лежат соответствующие workflow, в которых и исполняются все скрипты
- **/art/** - содержит обложку
- **/articles/** - там собраны все статьи с конференции
- **/bibliography-generator/** - тут хранится yml файл с метаинформаций для библиографии, её пример, а так же сам скрипт для её генерации
- **/fontsneeded/** - содержит необходимые для работы шрифты
- **/generator/** - изначальная программа на руби
- **/portraits/** - фотографии глав секций
- **/sections/** - рабочая папка для секций, так же содержит файл proceedings.yml, с помощью которого происходит управление сборкой
- **/template-check-metadata-extraction/** - содержит программу для проверки шаблона, которая в свою очередь генерирует некоторые метаданные для сборщика
## Как это работает

В репозитории заведены 3 workflow. По сути это автоматические процессы, которые выполняют те или иные действия и срабатывают автоматически или вручную. Подробнее можно почитать [тут](https://docs.github.com/en/actions/writing-workflows/about-workflows#about-workflows). Каждый из них отвечает за разные действия: создание секций, проверка на
шаблон и сбор метаданных, сборка конференции и библиографии. Управление осуществляется через файл **/sections/proceedings.yml**, где указывается информация о статьях и секциях, по которой первый workflow начинает работу, и в случае успешного завершения запускает второй и тд.
## Рекомендации к использованию

### Пошаговое описание

1. Для начала нужно клонировать себе на GitHub данный репозиторий. Достичь это можно двумя способами:
- Сделать fork ([как это сделать](https://docs.github.com/ru/pull-requests/collaborating-with-pull-requests/working-with-forks/fork-a-repo#forking-a-repository)), далее можно работать прямо в ней, либо же дополнительно клонировать себе на компьютер [вот так](https://docs.github.com/ru/pull-requests/collaborating-with-pull-requests/working-with-forks/fork-a-repo#forking-a-repository).
- Сразу клонировать себе на компьютер [вот так](https://docs.github.com/en/repositories/creating-and-managing-repositories/cloning-a-repository#cloning-a-repository), затем создать удаленный репозиторий на основе клона [вот так](https://selectel.ru/blog/tutorials/git-remote-add-origin-or-how-to-work-with-remote-repositories/).

2. Теперь, опять же, есть два варианта: работать прямо в репозитории через сайт GitHub, или работать локально и делать git pull/git push. Оба варианта рабочие, но могут иметь незначительные нюансы.

3. В директории **/art/**, **/articles/**, **/portraits/** необходимо закинуть исходники (то что в описании этих папок), можно это делать по мере их появления, но без них работать не будет.

4. Нужно настроить генерацию библиографии. Для этого нужно заполнить метаинформацию в файле **/bibliography-generator/meta.yml**. По умолчанию имеет вид для конференции 2022 года:
```
booktitle: Материалы 9-й всероссийской научной конференции по проблемам информатики
series: СПИСОК '22
year: 2022
issn: 2310-4724, 2310-4732
location: Санкт-Петербург, Россия
publisher: ВВМ
address: Санкт-Петербург, Россия
```

5. Далее необходимо заполнить файл **/sections/proceedings.yml**.

Первая его строка это название для теха например: 
`title: '{\addfontfeature{LetterSpace=-3.5}Материалы 9-й всероссийской научной конференции по проблемам информатики СПИСОК-2022}'`

Потом идет список секций который имеет такой вид:
```
sections:
  - s01:
      name: Системное программирование
      heads:
        - name: Терехов Андрей Николаевич
          title: д.ф.-м.н., профессор, заведующий Кафедрой....
          photo: Terekhov.jpg
      status: true
      files:
        - s2_2.pdf
        - s2_3.pdf
```
Куда необходимо заполнить данные для каждой секции, согласно шаблону. Названия файлов и фото должны быть такие же как названия файлов из пункта 3.

6. Теперь, после сохранения изменений в данном файле (совершили commit, который изменяет этот файл) запустится первый workflow, который сделает следующее:
- Создаст в директории **/sections/** папки для каждой секции вида **/s01/** и тд.
- В каждой такой папке будут лежать файлы соответствующие этой секции, которые указывались в **proceedings.yml**
- Так же там будет лежать **section.yml** уникальный для каждой секции вида:
```
name: Системное программирование
heads:
- name: Терехов Андрей Николаевич
  title: д.ф.-м.н., профессор, заведующий Кафедрой....
  photo: Terekhov.jpg
status: true
```

7. Если первый workflow закончит свою работу без ошибок, то он автоматически запустит второй, который сделает следующее:
- Для каждой статьи совершается проверка на соответствие шаблону ([ссылка на него](https://github.com/spbu-se/spisok-latex-template)), и все найденые ошибки содержатся в папке кажой секции из прошлого пунка в файле **mistakes.txt**. 
- Также section.yml дополняется метаданными и принимает вид:
```
name: Параллельные алгоритмы и вэйвлетная обработка числовых потоков
heads:
- name: Демьянович Юрий Казимирович
  title: д.ф.-м.н., профессор, заведующий кафедрой параллельных алгоритмов СПбГУ
  photo: Demjanovich.jpg
status: true
articles:
  - title: Об устойчивости всплесковых разложений
    by:
      - Демьянович Ю.К.
      - Иванцова О. Н.
    file: s6_1.pdf
```

8. В случае успешного завершения, запускается финальный workflow, который произведет сборку **spisok.pdf** и **spisok.bib**.

### Замечания по использованию:

1. Статусы всех workflow можно посмотреть во вкладке Actions данного репозитория. Например у меня это находится по ссылке https://github.com/romak00/spisok-ci-conf-buider/actions.

2. Финальный workflow может завершится с ошибкой. Обычно это вызвано тем, что какая то из работ не подходит под шаблон и из нее не получается корректно извлечь метаданные, приведу пример:
ФИО написано не в том порядке - А. Б. Иванов (а не Иванов. А. Б.), тогда парсер может его просто не считать и файл **sections.yml** примет вид:
```
name: Фундаментальная информатика
heads:
- name: Косовская Татьяна Матвеевна
  title: д.ф.-м.н., профессор, заведующая Кафедрой информатики
  photo: Kosovskaya.jpg
status: true
articles:
  - title: Инструментарий для работы с динамическими отношениями
    by:
      - Федорченко Л. Н.
      - Криворучко Д. И.
    file: s2_3.pdf
                            <-----------
  - title: Степени двойки и вещественно-целочисленная линейная элиминация кванторов
    file: s2_2.pdf
```
Где в строке со стрелочкой должен был стоять автор.
Из за этого сборщик не может нормально считать этот файл и завершается с ошибкой. К сожалению все подобные ошибки отловить невозможно, поэтому и существует шаблон, а остальное приходится изменять в ручную.

3. Вообще у третьего workflow есть особенность, что он так же запускает при любом изменении в папке **/sections/** (за исключением файла **proceedings.yml** конечно). Но иногда нужно внести изменения, не запуская workflow. Проще всего это сделать просто добавив к commit-сообщению следующее: "[skip ci]" без кавычек. Подробнее об этом [тут](https://docs.github.com/en/actions/managing-workflow-runs-and-deployments/managing-workflow-runs/skipping-workflow-runs).

4. Все 3 настроенных workflow работают с автокоммитами. Это очень удобно, ведь позволяет автоматически сохранять изменения. Но из этого вытекают соответствующие проблемы. Если кратко то бесполезно запускать несколько workflow одновременно, лучше дожаться окончания работы одного из них. А так же лучше не вносить изменений самостоятельно, при работе одного из workflow. Нарушение этих пунктов приведет к тому, что workflow, когда отработает, просто не сможет внести и сохранить изменения.

5. Иногда бывает удобно запустить тот или иной workflow самостоятельно, не внося изменений или просто вне очереди. Как это сделать написано [тут](https://docs.github.com/en/actions/managing-workflow-runs-and-deployments/managing-workflow-runs/manually-running-a-workflow#running-a-workflow).

